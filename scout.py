from evony import *
import time
import webbrowser
import sys
from actionfactory.builder import *
from actionfactory.quest import *
from actionfactory.items import *
server=sys.argv[1].strip()
mailguy=sys.argv[2].strip()
declarewar=sys.argv[3].strip().split(',')
declarewar=int(declarewar[0])+int(declarewar[1])*800
scoutpos=sys.argv[4].strip().split(',')
scoutpos=int(scoutpos[0])+int(scoutpos[1])*800
def createacc(server,mailguy,declarewar,scoutpos):
	try:
		print("PROGRESSREPORT0")
		x=Client(server)
		print("PROGRESSREPORT1")
		y=x.registernewplayer()
		print("PROGRESSREPORT1")
		builder=Builder(x)
		print("PROGRESSREPORT2")
		castleid=y['data']['player']['castles'][0]['id']
		print("PROGRESSREPORT2")
		fieldid=y['data']['player']['castles'][0]['fieldId']
		print("PROGRESSREPORT3")
		quest=Quest(x,castleid)
		print("PROGRESSREPORT3")
		items=Item(x,castleid)
		print("PROGRESSREPORT4")
		x.client.sendmessage('common.addToFavorites',{})
		print("PROGRESSREPORT4")
		res=x.responsehandler('common.addToFavorites')
		print("PROGRESSREPORT5")
		quest.completequest(226)
		print("PROGRESSREPORT5")
		builder.createbuilding(castleid,0,1)
		print("PROGRESSREPORT6")
		builder.upgradebuilding(castleid,0,1,1)
		print("PROGRESSREPORT6")
		quest.completequest(1)
		print("PROGRESSREPORT7")
		items.useitem('player.box.present.2')
		print("PROGRESSREPORT7")
		quest.completequest(2)
		print("PROGRESSREPORT8")
		quest.completequest(535)
		print("PROGRESSREPORT8")
		builder.createbuilding(castleid,1,21)
		print("PROGRESSREPORT9")
		time.sleep(1)
		print("PROGRESSREPORT9")
		builder.createbuilding(castleid,2,29)
		print("PROGRESSREPORT10")
		time.sleep(2)
		print("PROGRESSREPORT10")
		builder.createbuilding(castleid,1001,7)
		print("PROGRESSREPORT11")
		quest.completequest(15)
		print("PROGRESSREPORT11")
		builder.createbuilding(castleid,1002,4)
		print("PROGRESSREPORT11")
		quest.completequest(16)
		print("PROGRESSREPORT12")
		builder.createbuilding(castleid,1003,5)
		print("PROGRESSREPORT12")
		quest.completequest(17)
		print("PROGRESSREPORT13")
		builder.createbuilding(castleid,1004,6)
		print("PROGRESSREPORT13")
		quest.completequest(18)
		print("PROGRESSREPORT14")
		time.sleep(2)
		print("PROGRESSREPORT14")
		x.client.sendmessage('interior.modifyCommenceRate',{'ironrate':100,'foodrate':100,'stonerate':100,'woodrate':100,'castleId':castleid})
		print("PROGRESSREPORT15")
		res=x.responsehandler('interior.modifyCommenceRate')
		print("PROGRESSREPORT15")
		quest.completequest(19)
		print("PROGRESSREPORT16")
		quest.completequest(80)
		print("PROGRESSREPORT16")
		quest.completequest(86)
		print("PROGRESSREPORT17")
		x.client.sendmessage('interior.modifyTaxRate',{'castleId':castleid,'tax':20})
		print("PROGRESSREPORT17")
		res=x.responsehandler('interior.modifyTaxRate')
		print("PROGRESSREPORT18")
		quest.completequest(20)
		print("PROGRESSREPORT18")
		x.client.sendmessage('city.modifyCastleName',{'castleId':castleid,'name':'NO','logUrl':'images/icon/cityLogo/citylogo_01.png'})
		print("PROGRESSREPORT19")
		res=x.responsehandler('city.modifyCastleName')
		print("PROGRESSREPORT19")
		quest.completequest(21)
		print("PROGRESSREPORT20")
		x.client.sendmessage('city.modifyFlag',{'newFlag':'JO'})
		print("PROGRESSREPORT20")
		res=x.responsehandler('city.modifyFlag')
		print("PROGRESSREPORT21")
		builder.createbuilding(castleid,3,23)
		print("PROGRESSREPORT21")
		builder.speedup(castleid,'consume.2.a',3)
		print("PROGRESSREPORT22")
		quest.completequest(22)
		print("PROGRESSREPORT22")
		builder.upgradebuilding(castleid,1002,4,1)
		print("PROGRESSREPORT22")
		quest.completequest(23)
		print("PROGRESSREPORT23")
		quest.completequest(138)
		print("PROGRESSREPORT23")
		builder.createbuilding(castleid,4,3)
		print("PROGRESSREPORT24")
		builder.speedup(castleid,'consume.2.a',4)
		print("PROGRESSREPORT24")
		quest.completequest(139)
		print("PROGRESSREPORT25")
		builder.createbuilding(castleid,5,1)
		print("PROGRESSREPORT25")
		builder.upgradebuilding(castleid,5,1,1)
		print("PROGRESSREPORT26")
		builder.createbuilding(castleid,6,1)
		print("PROGRESSREPORT26")
		builder.upgradebuilding(castleid,6,1,1)
		print("PROGRESSREPORT27")
		builder.createbuilding(castleid,7,1)
		print("PROGRESSREPORT27")
		builder.upgradebuilding(castleid,7,1,1)
		print("PROGRESSREPORT28")
		ddf=False
		print("PROGRESSREPORT28")
		quest.special()
		print("PROGRESSREPORT29")
		x.client.sendmessage('interior.taxation',{'typeId':3,'castleId':castleid})
		print("PROGRESSREPORT29")
		res=x.responsehandler('interior.taxation')
		print("PROGRESSREPORT30")
		quest.completequest(12)
		print("PROGRESSREPORT30")
		quest.completequest(155)
		print("PROGRESSREPORT31")
		builder.upgradebuilding(castleid,-1)
		print("PROGRESSREPORT31")
		builder.speedup(castleid,'consume.2.a',-1)
		print("PROGRESSREPORT32")
		builder.speedup(castleid,'consume.2.a',-1)
		print("PROGRESSREPORT32")
		quest.completequest(26)
		print("PROGRESSREPORT33")
		quest.completequest(194)
		print("PROGRESSREPORT33")
		quest.completequest(214)
		print("PROGRESSREPORT33")
		items.useitem('player.box.gambling.3')
		print("PROGRESSREPORT34")
		quest.completequest(223)
		print("PROGRESSREPORT34")
		builder.createbuilding(castleid,8,25)
		print("PROGRESSREPORT35")
		builder.speedup(castleid,'consume.2.a',8)
		print("PROGRESSREPORT35")
		quest.completequest(35)
		print("PROGRESSREPORT36")
		quest.completequest(210)
		print("PROGRESSREPORT36")
		builder.createbuilding(castleid,9,2)
		print("PROGRESSREPORT37")
		quest.completequest(87)
		print("PROGRESSREPORT37")
		x.client.sendmessage('mail.sendMail',{'username':mailguy,'content':'Hey','title':'Hi'})
		print("PROGRESSREPORT38")
		res=x.responsehandler('mail.sendMail')
		print("PROGRESSREPORT38")
		quest.completequest(78)
		print("PROGRESSREPORT39")
		quest.completequest(87)
		print("PROGRESSREPORT39")
		x.client.sendmessage('common.worldChat',{'msg':'-','languageType':0})
		print("PROGRESSREPORT40")
		res=x.responsehandler('common.worldChat')
		print("PROGRESSREPORT40")
		quest.completequest(79)
		print("PROGRESSREPORT41")
		quest.completequest(87)
		print("PROGRESSREPORT41")
		builder.createbuilding(castleid,10,27)
		print("PROGRESSREPORT42")
		quest.completequest(81)
		print("PROGRESSREPORT42")
		quest.completequest(87)
		print("PROGRESSREPORT43")
		builder.upgradebuilding(castleid,1004,6,1)
		print("PROGRESSREPORT43")
		builder.upgradebuilding(castleid,1004)
		print("PROGRESSREPORT44")
		builder.speedup(castleid,'consume.2.a',1004)
		print("PROGRESSREPORT44")
		builder.createbuilding(castleid,11,22)
		print("PROGRESSREPORT44")
		quest.completequest(111)
		print("PROGRESSREPORT45")
		builder.upgradebuilding(castleid,11)
		print("PROGRESSREPORT45")
		builder.speedup(castleid,'consume.2.a',11)
		print("PROGRESSREPORT46")
		time.sleep(2)
		print("PROGRESSREPORT46")
		builder.createbuilding(castleid,12,26)
		print("PROGRESSREPORT47")
		builder.speedup(castleid,'consume.2.a',12)
		print("PROGRESSREPORT47")
		quest.completequest(112)
		print("PROGRESSREPORT48")
		builder.upgradebuilding(castleid,1003,5,1)
		print("PROGRESSREPORT48")
		time.sleep(2)
		print("PROGRESSREPORT49")
		builder.createbuilding(castleid,-2,32)
		print("PROGRESSREPORT49")
		builder.speedup(castleid,'consume.2.a',-2)
		print("PROGRESSREPORT50")
		builder.speedup(castleid,'consume.2.a',-2)
		print("PROGRESSREPORT50")
		quest.completequest(240)
		print("PROGRESSREPORT51")
		quest.completequest(113)
		print("PROGRESSREPORT51")
		quest.completequest(184)
		print("PROGRESSREPORT52")
		builder.upgradebuilding(castleid,-1)
		print("PROGRESSREPORT52")
		builder.speedup(castleid,'consume.2.b',-1)
		print("PROGRESSREPORT53")
		quest.completequest(241)
		print("PROGRESSREPORT53")
		quest.completequest(27)
		print("PROGRESSREPORT54")
		quest.completequest(211)
		print("PROGRESSREPORT54")
		builder.createbuilding(castleid,13,30)
		print("PROGRESSREPORT55")
		builder.speedup(castleid,'consume.2.b',13)
		print("PROGRESSREPORT55")
		quest.completequest(145)
		print("PROGRESSREPORT56")
		quest.completequest(581,wait=False)
		print("PROGRESSREPORT56")
		quest.completequest(582,wait=False)
		print("PROGRESSREPORT56")
		x.client.sendmessage('trade.newTrade',{'castleId':castleid,'price':'1','tradeType':0,'amount':20000,'resType':2})
		print("PROGRESSREPORT57")
		amount=0
		print("PROGRESSREPORT57")
		idlist=[]
		print("PROGRESSREPORT58")
		while amount<20000:
			print("PROGRESSREPORT58")
			res=x.responsehandler('server.TransingTradeUpdate',checkok=False)
			print("PROGRESSREPORT59")
			tramount=res['data']['bean']['amount']
			print("PROGRESSREPORT59")
			trid=res['data']['bean']['id']
			print("PROGRESSREPORT60")
			if trid in idlist:
				print("PROGRESSREPORT60")
				continue
			print("PROGRESSREPORT61")
			idlist.append(trid)
			print("PROGRESSREPORT61")
			amount+=tramount
			print("PROGRESSREPORT62")
			if tramount>=10000:
				print("PROGRESSREPORT62")
				break
			print("PROGRESSREPORT63")
			if amount>=20000:
				print("PROGRESSREPORT63")
				raise
		print("PROGRESSREPORT64")
		x.client.sendmessage('trade.speedUpTrans',{'itemId':'consume.transaction.1','castleId':castleid,'transingTradeId':trid})
		print("PROGRESSREPORT64")
		res=x.responsehandler('trade.speedUpTrans')
		print("PROGRESSREPORT65")
		time.sleep(5)
		print("PROGRESSREPORT65")
		builder.upgradebuilding(castleid,-2)
		print("PROGRESSREPORT66")
		builder.speedup(castleid,'consume.2.b',-2)
		print("PROGRESSREPORT66")
		quest.completequest(114)
		print("PROGRESSREPORT67")
		items.useitem('player.box.present.4')
		print("PROGRESSREPORT67")
		items.useitem('player.box.special.1')
		print("PROGRESSREPORT67")
		quest.completequest(536)
		print("PROGRESSREPORT68")
		quest.completequest(97)
		print("PROGRESSREPORT68")
		quest.completequest(199)
		print("PROGRESSREPORT69")
		quest.completequest(215)
		print("PROGRESSREPORT69")
		quest.completequest(216)
		print("PROGRESSREPORT70")
		quest.completequest(185)
		print("PROGRESSREPORT70")
		x.client.sendmessage('troop.disbandTroop',{'troopType':2,'castleId':castleid,'num':250})
		print("PROGRESSREPORT71")
		res=x.responsehandler('troop.disbandTroop')
		print("PROGRESSREPORT71")
		x.client.sendmessage('trade.newTrade',{'castleId':castleid,'price':'1','tradeType':0,'amount':70000,'resType':2})
		print("PROGRESSREPORT72")
		amount=0
		print("PROGRESSREPORT72")
		while amount<70000:
			print("PROGRESSREPORT73")
			res=x.responsehandler('server.TransingTradeUpdate',checkok=False)
			print("PROGRESSREPORT73")
			tramount=res['data']['bean']['amount']
			print("PROGRESSREPORT74")
			trid=res['data']['bean']['id']
			print("PROGRESSREPORT74")
			if trid in idlist:
				print("PROGRESSREPORT75")
				continue
			print("PROGRESSREPORT75")
			idlist.append(trid)
			print("PROGRESSREPORT76")
			amount+=tramount
			print("PROGRESSREPORT76")
			if tramount>=30000:
				print("PROGRESSREPORT77")
				break
			print("PROGRESSREPORT77")
			if amount>=70000:
				print("PROGRESSREPORT78")
				raise
		print("PROGRESSREPORT78")
		x.client.sendmessage('trade.speedUpTrans',{'itemId':'consume.transaction.1','castleId':castleid,'transingTradeId':trid})
		print("PROGRESSREPORT78")
		res=x.responsehandler('trade.speedUpTrans')
		print("PROGRESSREPORT79")
		time.sleep(5)
		print("PROGRESSREPORT79")
		builder.upgradebuilding(castleid,-2)
		print("PROGRESSREPORT80")
		builder.speedup(castleid,'consume.2.b.1',-2)
		print("PROGRESSREPORT80")
		quest.completequest(115)
		print("PROGRESSREPORT81")
		quest.completequest(186)
		print("PROGRESSREPORT81")
		x.client.sendmessage('shop.getBuyResourceInfo',{'castleId':castleid})
		print("PROGRESSREPORT82")
		res=x.responsehandler('shop.getBuyResourceInfo')
		print("PROGRESSREPORT82")
		x.client.sendmessage('shop.buyResource',{'castleId':castleid,'stoneUse': 0, 'foodUse': 0, 'woodUse': 2, 'ironUse': 0})
		print("PROGRESSREPORT83")
		res=x.responsehandler('shop.buyResource')
		print("PROGRESSREPORT83")
		builder.upgradebuilding(castleid,-1)
		print("PROGRESSREPORT84")
		builder.speedup(castleid,'consume.2.b.1',-1)
		print("PROGRESSREPORT84")
		quest.completequest(28)
		print("PROGRESSREPORT85")
		quest.completequest(195)
		print("PROGRESSREPORT85")
		builder.upgradebuilding(castleid,-1)
		print("PROGRESSREPORT86")
		builder.speedup(castleid,'consume.2.b',-1)
		print("PROGRESSREPORT86")
		builder.speedup(castleid,'consume.2.b',-1)
		print("PROGRESSREPORT87")
		builder.speedup(castleid,'consume.2.b',-1)
		print("PROGRESSREPORT87")
		builder.speedup(castleid,'consume.2.b',-1)
		print("PROGRESSREPORT88")
		quest.completequest(29)
		print("PROGRESSREPORT88")
		quest.completequest(209)
		print("PROGRESSREPORT89")
		items.buyitem('player.trick.jbqy')
		print("PROGRESSREPORT89")
		x.client.sendmessage('shop.useTrickItem',{'itemId':'player.trick.jbqy', 'armyid': 0, 'castleId': fieldid})
		print("PROGRESSREPORT89")
		res=x.responsehandler('shop.useTrickItem')
		print("PROGRESSREPORT90")
		quest.completequest(212)
		print("PROGRESSREPORT90")
		quest.completequest(552)
		print("PROGRESSREPORT91")
		items.buyitem('player.trick.bxez')
		print("PROGRESSREPORT91")
		x.client.sendmessage('shop.useTrickItem',{'itemId':'player.trick.bxez','armyid':0,'castleId':declarewar})
		print("PROGRESSREPORT92")
		res=x.responsehandler('shop.useTrickItem')
		print("PROGRESSREPORT92")
		quest.completequest(553)
		print("PROGRESSREPORT93")
		time.sleep(2)
		print("PROGRESSREPORT93")
		items.buyitem('player.trick.lywh')
		print("PROGRESSREPORT94")
		x.client.sendmessage('shop.useTrickItem',{'itemId':'player.trick.lywh','armyid':0,'castleId':scoutpos})
		print("PROGRESSREPORT94")
		res=x.responsehandler('shop.useTrickItem')
		print("PROGRESSREPORT95")
		time.sleep(5)
		print("PROGRESSREPORT95")
		x.client.sendmessage('report.receiveReportList',{'reportType': 3, 'pageSize': 5, 'pageNo': 1})
		print("PROGRESSREPORT96")
		res=x.responsehandler('report.receiveReportList')
		print("PROGRESSREPORT96")
		reportid=res['data']['reports'][0]['id']
		print("PROGRESSREPORT97")
		x.client.sendmessage('report.markAsRead',{'reportId':reportid})
		print("PROGRESSREPORT97")
		res=x.responsehandler('report.markAsRead')
		print("PROGRESSREPORT98")
		report=res['data']['report']['content']
		print("PROGRESSREPORT98")
		reporturl=report.split('<reportData reportUrl=\"')[1].split('\"')[0]
		print("PROGRESSREPORT99")
		webbrowser.open(reporturl)
		print("PROGRESSREPORT99")
		print("\n\n")
		print("PROGRESSREPORT100")
		print("FINISHREPORT"+reporturl)
		print("PROGRESSREPORT100")
		x.close()
		return reporturl
	except:
		x.close()
		print("ERRORREPORT")
createacc(server,mailguy,declarewar,scoutpos)